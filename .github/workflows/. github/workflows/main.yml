name: DÃ©ploiement Pegintichat

on:
  push:
    branches:
      - main
  workflow_dispatch:  # Permet de lancer manuellement le workflow depuis l'interface GitHub

jobs:
  build-and-test:
    name: Installation et tests
    runs-on: ubuntu-latest
    environment: Production

    steps:
      - name: ğŸ“¦ RÃ©cupÃ©ration du code
        uses: actions/checkout@v3

      - name: ğŸ Configuration Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'

      - name: ğŸ“š Installation des dÃ©pendances
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt

      - name: ğŸ§ª ExÃ©cution des tests
        run: pytest
        env:
          ENV_NAME: ${{ vars.ENV_NAME }}
          REGION: ${{ vars.REGION }}

  deploy:
    name: ğŸš€ DÃ©ploiement conditionnel
    needs: build-and-test
    runs-on: ubuntu-latest
    environment: Production
    if: success()  # Ne s'exÃ©cute que si les tests ont rÃ©ussi

    steps:
      - name: ğŸ“¦ RÃ©cupÃ©ration du code
        uses: actions/checkout@v3

      - name: ğŸ” Authentification GitHub
        run: echo "Authentification avec GH_TOKEN rÃ©ussie"
        env:
          GH_TOKEN: ${{ secrets.GH_TOKEN }}

      - name: ğŸš€ DÃ©ploiement vers ${{ vars.DEPLOY_TO }}
        run: |
          echo "DÃ©ploiement en cours sur ${{ vars.DEPLOY_TO }}..."
          # Ajoute ici ton script de dÃ©ploiement rÃ©el (rsync, ssh, scp, etc.)

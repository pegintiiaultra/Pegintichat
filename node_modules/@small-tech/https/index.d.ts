import {
  ClientRequest,
  IncomingMessage,
  ServerResponse,
  RequestListener,
} from "node:http"
import { RequestOptions, Server, ServerOptions } from "node:https"
import EventEmitter from "node:events"
import { AutoEncryptedLocalhostServer } from "@small-tech/auto-encrypt-localhost"
import { AutoEncryptedServer, AutoEncryptOptions, IPAddresses } from "@small-tech/auto-encrypt"

export { IPAddresses }

export class Events extends EventEmitter {
  CREATING_SERVER: symbol
  SERVER_CREATED: symbol
  SERVER_CLOSED: symbol
}

export const events: Events
export const SMALL_TECH_HOME_PATH: string
export const DEFAULT_SETTINGS_PATH: string

export type SmallTechHttpsOptions = AutoEncryptOptions & {
  staging?: boolean
}

export function request(
  options: RequestOptions | string | URL,
  callback?: (res: IncomingMessage) => void
): ClientRequest

export function request(
  url: string | URL,
  options: RequestOptions,
  callback?: (res: IncomingMessage) => void
): ClientRequest


declare const _default: typeof import("node:https") & {
  createServer: typeof createServer
  request: typeof request
}

declare class https {
  static async createServer<
    Request extends typeof IncomingMessage = typeof IncomingMessage,
    Response extends typeof ServerResponse = typeof ServerResponse
  >(
    requestListener?: RequestListener<Request, Response>
  ): Promise<AutoEncryptedLocalhostServer> | Promise<AutoEncryptedServer>

  static async createServer<
    Request extends typeof IncomingMessage = typeof IncomingMessage,
    Response extends typeof ServerResponse = typeof ServerResponse
  >(
    options: SmallTechHttpsOptions,
    requestListener?: RequestListener<Request, Response>
  ): Promise<AutoEncryptedLocalhostServer> | Promise<AutoEncryptedServer>
}

export default https
